<!doctype html><html><head><title>Continuous Integration &#183; build-tools</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="build-tools"><meta name=description content="desc"><meta http-equiv=content-language content="en-us"><meta name=generator content="Hugo 0.79.1"><link rel=icon href=favicon.ico><meta name=theme-color content="#000"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name=theme-color content="black"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="build-tools"><meta name=twitter:description content="desc"><meta name=twitter:image content="https://buildtools.io/card.png"><meta name=og:title content="build-tools"><meta name=og:description content="desc"><meta name=og:url content="https://buildtools.io/"><meta name=og:image content="https://buildtools.io/card.png"><meta property="og:type" content="website"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link rel=stylesheet href=https://buildtools.io/css/index.css><link rel=apple-touch-icon href=https://buildtools.io/apple-touch-icon.png><link rel="shortcut icon" href=https://buildtools.io/favicon.ico type=image/x-icon></head><body><div class=Wrapper><div class=Container><div class=Header><a href=https://buildtools.io/><div class="Title center"><img alt="build-tools Logo" src=https://github.com/buildtool.png height=140>
<span class=text>build-tools</span>
<span class=subtext></span></div></a></div><div class=Content-wrapper><div class=Sidebar><div class=Menu><div class=item><a href=https://buildtools.io/>Home</a></div><div class=item><a href=https://buildtools.io/introduction/>Introduction</a></div><div class=item><a href=https://buildtools.io/installation/>Installation</a></div><div class=item><a href=https://buildtools.io/conventions/>Conventions</a></div><div class=item><a href=https://buildtools.io/quickstart/>Quickstart</a></div><div class=item><a href=https://buildtools.io/commands/>Commands</a></div><div class=item><a href=https://buildtools.io/ci/>Continuous Integration</a></div><div class=item><a href=https://buildtools.io/config/>Configuration files</a></div><div class=item><a href=https://buildtools.io/registry/>Registry</a></div><div class=item><a href=https://buildtools.io/environments/>Environments</a></div><div class=item><a href=https://buildtools.io/k8s/>Kubernetes</a></div><div class=item><a href=https://buildtools.io/contributing/>Contributing</a></div></div></div><div class=Content><div class=Page><h1>Continuous Integration</h1><p>Commands recognize which CI/CD environment they are executed in based on which environment variables are present.</p><table><thead><tr><th style=text-align:left>Environment variable</th><th style=text-align:left>CI/CD</th></tr></thead><tbody><tr><td style=text-align:left><code>BUILDKITE_PIPELINE_SLUG</code></td><td style=text-align:left><a href=#Buildkite>Buildkite</a></td></tr><tr><td style=text-align:left><code>CI_PROJECT_NAME</code></td><td style=text-align:left><a href=https://docs.gitlab.com/ce/ci>Gitlab CI</a>(#Gitlab CI)</td></tr><tr><td style=text-align:left><code>RUNNER_WORKSPACE</code></td><td style=text-align:left><a href=https://github.com/features/actions>Github Actions</a>(#Github Actions)</td></tr><tr><td style=text-align:left><code>TEAMCITY_PROJECT_NAME</code></td><td style=text-align:left><a href=#TeamCity>TeamCity</a></td></tr><tr><td style=text-align:left><code>BUILD_REPOSITORY_NAME</code></td><td style=text-align:left><a href=https://azure.microsoft.com/en-us/services/devops/pipelines/>Azure Devops</a>(#Azure Devops)</td></tr></tbody></table><h2 id=examples>Examples</h2><h3 id=buildkite>Buildkite</h3><p><a href=https://buildkite.com>Buildkite</a> is configured with <code>.buildkite/pipeline.yml</code> file in your project.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>steps</span>:
  - <span style=color:#ff79c6>command</span>: |-<span style=color:#f1fa8c>
</span><span style=color:#f1fa8c>      build
</span><span style=color:#f1fa8c>      push</span>      
    <span style=color:#ff79c6>label</span>: build
    <span style=color:#ff79c6>plugins</span>:
      - <span style=color:#ff79c6>docker#v3.3.0</span>:
          <span style=color:#ff79c6>image</span>: buildtool/build-tools
          <span style=color:#ff79c6>volumes</span>:
            - <span style=color:#f1fa8c>&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span>
          <span style=color:#ff79c6>propagate-environment</span>: <span style=color:#ff79c6>true</span>
  - wait

  - <span style=color:#ff79c6>block</span>: <span style=color:#f1fa8c>&#34;:rocket: Release PROD&#34;</span>
    <span style=color:#ff79c6>branches</span>: <span style=color:#f1fa8c>&#34;main&#34;</span>

  - <span style=color:#ff79c6>command</span>: |-<span style=color:#f1fa8c>
</span><span style=color:#f1fa8c>      </span>      deploy prod
    <span style=color:#ff79c6>label</span>: Deploy PROD
    <span style=color:#ff79c6>branches</span>: <span style=color:#f1fa8c>&#34;main&#34;</span>
    <span style=color:#ff79c6>plugins</span>:
      - <span style=color:#ff79c6>docker#v3.3.0</span>:
          <span style=color:#ff79c6>image</span>: buildtool/build-tools
          <span style=color:#ff79c6>volumes</span>:
            - <span style=color:#f1fa8c>&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span>
          <span style=color:#ff79c6>propagate-environment</span>: <span style=color:#ff79c6>true</span>
</code></pre></div><h3 id=gitlab-ci>Gitlab CI</h3><p><a href=https://docs.gitlab.com/ce/ci>Gitlab CI</a> is configured with a <code>.gitlab-ci.yaml</code> file in your project.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>stages</span>:
  - build
  - deploy-staging
  - deploy-prod

<span style=color:#ff79c6>variables</span>:
  <span style=color:#ff79c6>DOCKER_HOST</span>: tcp://docker:2375/

<span style=color:#ff79c6>image</span>: buildtool/build-tools:latest

<span style=color:#ff79c6>build</span>:
  <span style=color:#ff79c6>stage</span>: build
  <span style=color:#ff79c6>services</span>:
    - docker:dind
  <span style=color:#ff79c6>script</span>:
  - build
  - push

<span style=color:#ff79c6>deploy-to-staging</span>:
  <span style=color:#ff79c6>stage</span>: deploy-staging
  <span style=color:#ff79c6>when</span>: on_success
  <span style=color:#ff79c6>script</span>:
    - echo Deploy to staging.
    - deploy staging
  <span style=color:#ff79c6>environment</span>:
    <span style=color:#ff79c6>name</span>: staging

<span style=color:#ff79c6>deploy-to-prod</span>:
  <span style=color:#ff79c6>stage</span>: deploy-prod
  <span style=color:#ff79c6>when</span>: on_success
  <span style=color:#ff79c6>script</span>:
    - echo Deploy to PROD.
    - deploy prod
  <span style=color:#ff79c6>environment</span>:
    <span style=color:#ff79c6>name</span>: prod
  <span style=color:#ff79c6>only</span>:
    - main
</code></pre></div><h3 id=github-actions>Github Actions</h3><p>Build-tools can also be used within our official build-tools actions through <a href=https://github.com/features/actions>GitHub Actions</a></p><p>You can create a workflow for pushing your releases by putting YAML configuration to <code>.github/workflows/build.yml</code>.</p><p>Below is a simple snippet to use the <a href=https://github.com/buildtool/build-action>build-action</a> and <a href=https://github.com/buildtool/push-action>push-action</a> in your workflow:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>name</span>: Buildtool
<span style=color:#ff79c6>on</span>: [push]
<span style=color:#ff79c6>jobs</span>:
  <span style=color:#ff79c6>build</span>:
    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
    <span style=color:#ff79c6>env</span>:
      <span style=color:#ff79c6>DOCKERHUB_USERNAME</span>: sparetimecoders
      <span style=color:#ff79c6>DOCKERHUB_PASSWORD</span>: ${{ secrets.DOCKERHUB_PASSWORD }}
      <span style=color:#ff79c6>DOCKERHUB_NAMESPACE</span>: sparetimecoders
    <span style=color:#ff79c6>steps</span>:
      - <span style=color:#ff79c6>name</span>: Checkout
        <span style=color:#ff79c6>uses</span>: actions/checkout@v1
      - <span style=color:#ff79c6>name</span>: build
        <span style=color:#ff79c6>uses</span>: buildtool/build-action@v1
      - <span style=color:#ff79c6>name</span>: push
        <span style=color:#ff79c6>uses</span>: buildtool/push-action@v1
</code></pre></div><p>Read more about our actions here:</p><ul><li><a href=https://github.com/buildtool/build-action>build-action</a></li><li><a href=https://github.com/buildtool/push-action>push-action</a></li><li><a href=https://github.com/buildtool/deploy-action>deploy-action</a></li></ul><blockquote><p>For detailed intructions please follow GitHub Actions <a href=https://help.github.com/en/articles/workflow-syntax-for-github-actions#About-yaml-syntax-for-workflows>workflow syntax</a>.</p></blockquote><h3 id=teamcity>TeamCity</h3><p><a href=https://www.jetbrains.com/teamcity>TeamCity</a> can be configured with a <code>.teamcity/settings.kts</code> file in your project.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>import</span> jetbrains.buildServer.configs.kotlin.v2018_2.*
<span style=color:#ff79c6>import</span> jetbrains.buildServer.configs.kotlin.v2018_2.buildSteps.ScriptBuildStep
<span style=color:#ff79c6>import</span> jetbrains.buildServer.configs.kotlin.v2018_2.buildSteps.script
<span style=color:#ff79c6>import</span> jetbrains.buildServer.configs.kotlin.v2018_2.triggers.finishBuildTrigger
<span style=color:#ff79c6>import</span> jetbrains.buildServer.configs.kotlin.v2018_2.triggers.vcs

version = <span style=color:#f1fa8c>&#34;2019.1&#34;</span>

project {
    buildType(BuildAndPush)
}

<span style=color:#ff79c6>object</span> <span style=color:#50fa7b>BuildAndPush</span> : BuildType({
    name = <span style=color:#f1fa8c>&#34;BuildAndPush&#34;</span>

    steps {
        script {
            name = <span style=color:#f1fa8c>&#34;build and push&#34;</span>
            scriptContent = <span style=color:#f1fa8c>&#34;&#34;&#34;
</span><span style=color:#f1fa8c>                build &amp;&amp; push
</span><span style=color:#f1fa8c>            &#34;&#34;&#34;</span>.trimIndent()
            dockerImage = <span style=color:#f1fa8c>&#34;buildtool/buildtools&#34;</span>
            dockerImagePlatform = ScriptBuildStep.ImagePlatform.Linux
            dockerPull = <span style=color:#ff79c6>true</span>
            dockerRunParameters = <span style=color:#f1fa8c>&#34;&#34;&#34;
</span><span style=color:#f1fa8c>                -v /var/run/docker.sock:/var/run/docker.sock
</span><span style=color:#f1fa8c>                --rm
</span><span style=color:#f1fa8c>            &#34;&#34;&#34;</span>.trimIndent()
        }
    }

    triggers {
        vcs {}
    }
})

</code></pre></div><h3 id=azure-devops>Azure Devops</h3><p><a href=https://azure.microsoft.com/en-us/services/devops/pipelines/>Azure Devops</a> is configured with a <code>azure-pipelines.yml</code> file in your project.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>resources</span>:
  <span style=color:#ff79c6>containers</span>:
  - <span style=color:#ff79c6>container</span>: build-tools
    <span style=color:#ff79c6>image</span>: buildtool/build-tools:latest

<span style=color:#ff79c6>jobs</span>:
- <span style=color:#ff79c6>job</span>: build_and_deploy
  <span style=color:#ff79c6>pool</span>:
    <span style=color:#ff79c6>vmImage</span>: <span style=color:#f1fa8c>&#39;Ubuntu 16.04&#39;</span>
  <span style=color:#ff79c6>container</span>: build-tools
  <span style=color:#ff79c6>steps</span>:
  - <span style=color:#ff79c6>script</span>: |<span style=color:#f1fa8c>
</span><span style=color:#f1fa8c>      build
</span><span style=color:#f1fa8c>      push</span>      
    <span style=color:#ff79c6>name</span>: build
    <span style=color:#ff79c6>env</span>:
      <span style=color:#ff79c6>QUAY_PASSWORD</span>: $(QUAY_PASSWORD)
  - <span style=color:#ff79c6>script</span>: deploy staging
    <span style=color:#ff79c6>name</span>: deploy_staging
    <span style=color:#ff79c6>condition</span>: succeeded()
</code></pre></div><blockquote><p>Last updated by Peter Svensson on January 22, 2021.
<a href=https://github.com/buildtool/build-tools/edit/main/www/content/ci.md>Improve this page</a>.</p></blockquote></div><div class=Footer><p>© 2019 buildtool</p></div><script src=https://buildtools.io/js/index.js></script></div></div></div></body></html>