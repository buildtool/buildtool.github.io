<!doctype html><html><head><title>build-tools</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=build-tools><meta name=description content=desc><meta http-equiv=content-language content=en-us><meta name=generator content="Hugo 0.58.3"><link rel=icon href=favicon.ico><meta name=theme-color content=#000><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name=theme-color content=black><meta name=twitter:card content=summary_large_image><meta name=twitter:title content=build-tools><meta name=twitter:description content=desc><meta name=twitter:image content=https://buildtool.github.io/card.png><meta name=og:title content=build-tools><meta name=og:description content=desc><meta name=og:url content=https://buildtool.github.io/><meta name=og:image content=https://buildtool.github.io/card.png><meta property=og:type content=website><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black><link rel=stylesheet href=https://buildtool.github.io/css/index.css><link rel=apple-touch-icon href=https://buildtool.github.io/apple-touch-icon.png><link rel="shortcut icon" href=https://buildtool.github.io/favicon.ico type=image/x-icon></head><body><div class=Wrapper><div class=Container><div class=Header><a href=https://buildtool.github.io/><div class="Title center"><img alt="build-tools Logo" src=https://github.com/buildtool.png height=140>
<span class=text>build-tools</span>
<span class=subtext></span></div></a></div><div class=Content-wrapper><div class=Sidebar><div class=Menu><div class=item><a href=https://buildtool.github.io/>Home</a></div><div class=item><a href=https://buildtool.github.io/introduction/>Introduction</a></div><div class=item><a href=https://buildtool.github.io/installation/>Installation</a></div><div class=item><a href=https://buildtool.github.io/conventions/>Conventions</a></div><div class=item><a href=https://buildtool.github.io/quickstart/>Quickstart</a></div><div class=item><a href=https://buildtool.github.io/commands/>Commands</a></div><div class=item><a href=https://buildtool.github.io/ci/>Continuous Integration</a></div><div class=item><a href=https://buildtool.github.io/config/>Configuration files</a></div><div class=item><a href=https://buildtool.github.io/registry/>Registry</a></div><div class=item><a href=https://buildtool.github.io/environments/>Environments</a></div><div class=item><a href=https://buildtool.github.io/contributing/>Contributing</a></div></div></div><div class=Content><div class=Page id=Introduction><h1><a href=https://buildtool.github.io/introduction/>Introduction</a></h1><p><a href=https://github.com/buildtool/build-tools>build-tools</a> is a set of highly opinionated tools for creating and building components/services into <a href=https://www.docker.com/>docker</a> images and deploying them to <a href=https://kubernetes.io/>Kubernetes</a> clusters.</p><p>By following the conventions set by the tools, building and deploying applications is made simpler.</p><p>The only hard requirement is to provide a <a href=https://docs.docker.com/engine/reference/builder/>Dockerfile</a> which describes how to build and run your application.</p><p>The configuration needed is done by environment variables (most likely for CI/CD) and yaml files (for local use).</p></div><div class=Page id=Installation><h1><a href=https://buildtool.github.io/installation/>Installation</a></h1><p>You can install the pre-compiled binary (in several different ways), use Docker or compile from source.</p><h2 id=installation-pre-built-binaries>Installation pre-built binaries</h2><p><strong>Homebrew tap</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ brew install buildtooltaps/build-tools</code></pre></div><p><strong>Shell script</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ curl -sfL https://raw.githubusercontent.com/buildtool/build-tools/master/install.sh | sh</code></pre></div><p><strong>Manually</strong></p><p>Download the pre-compiled binaries from the <a href=https://github.com/buildtool/build-tools/releases>releases</a> page and copy to the desired location.</p><h2 id=docker>Docker</h2><p>You can also use it within a Docker container. To do that, you’ll need to execute something more-or-less like the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ docker run --rm --privileged <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -v <span style=color:#8be9fd;font-style:italic>$PWD</span>:/repo <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -v /var/run/docker.sock:/var/run/docker.sock <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -w /repo <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -e DOCKER_USERNAME <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -e DOCKER_PASSWORD <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  buildtool/build-tools build</code></pre></div><h2 id=compiling-from-source>Compiling from source</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>    <span style=color:#6272a4># clone it outside GOPATH</span>
    $ git clone https://github.com/buildtool/build-tools
    $ <span style=color:#8be9fd;font-style:italic>cd</span> build-tools
    
    <span style=color:#6272a4># get dependencies using go modules (needs go 1.11+)</span>
    $ go get ./...
    
    <span style=color:#6272a4># build</span>
    $ go build ./cmd/build
    
    <span style=color:#6272a4># check it works</span>
    ./build -version</code></pre></div></div><div class=Page id=Conventions><h1><a href=https://buildtool.github.io/conventions/>Conventions</a></h1><ul><li><code>Dockerfile</code> must be present in the root of the project directory (this can be overriden with <a href=/commands#build>flags</a>). The <code>Dockerfile</code> will be used to build the project into a runnable docker image.</li><li>Kubernetes descriptor files must be located in the <code>k8s</code> folder</li><li>The name of the directory will be used as the name of the docker image (if running in CI <code>ENV</code> variables will be used to determine the name of the project being built)</li><li>The current commit id will be used as docker tag</li></ul><p>Take a look at the <a href=https://github.com/buildtool/build-tools-examples>build-tools-example repository</a> to try it out.</p></div><div class=Page id=Quickstart><h1><a href=https://buildtool.github.io/quickstart/>Quickstart</a></h1></div><div class=Page id=Commands><h1><a href=https://buildtool.github.io/commands/>Commands</a></h1><h2 id=available-commands>Available commands</h2><h3 id=build>build</h3><p>Performs a <code>docker build</code>, using a <code>Dockerfile</code> to build the application and tags the resulting image. By following the conventions no additional flags are needed, but the following flags are available:</p><table><thead><tr><th align=left>Flag</th><th align=left>Description</th></tr></thead><tbody><tr><td align=left><code>-f/--file &lt;path to Dockerfile&gt;</code></td><td align=left>Used to override the default <code>Dockerfile</code> location (which is <code>$PWD</code>)</td></tr><tr><td align=left><code>-skiplogin</code></td><td align=left>Disables login to docker registry (good for local testing)</td></tr><tr><td align=left><code>-build-arg key=value</code></td><td align=left>Additional Docker <a href=https://docs.docker.com/engine/reference/commandline/#set-build-time-variables---build-arg>build-arg</a></td></tr></tbody></table><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ build -f docker/Dockerfile.build -skiplogin -build-arg <span style=color:#8be9fd;font-style:italic>AUTH_TOKEN</span><span style=color:#ff79c6>=</span>abc</code></pre></div><h3 id=push>push</h3><p>Performs a <code>docker push</code> of the image created by <code>build</code>.</p><p>By following the conventions no additional flags are needed, but the following flags are available:</p><table><thead><tr><th align=left>Flag</th><th align=left>Description</th></tr></thead><tbody><tr><td align=left><code>-f/--file &lt;path to Dockerfile&gt;</code></td><td align=left>Used to override the default <code>Dockerfile</code> location (which is <code>$PWD</code>)</td></tr></tbody></table><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ push -f docker/Dockerfile.build </code></pre></div><h3 id=deploy>deploy</h3><p>Deploys the built application to a Kubernetes cluster. Normal usage <code>deploy &lt;environment&gt;</code>, but additional flags can be used to override:</p><table><thead><tr><th align=left>Flag</th><th align=left>Description</th></tr></thead><tbody><tr><td align=left><code>-c/--context</code></td><td align=left>Use a different context than the one found in configuration</td></tr><tr><td align=left><code>-n/--namespace</code></td><td align=left>Use a different namespace than the one found in configuration</td></tr></tbody></table><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ deploy -n testing_namespace <span style=color:#8be9fd;font-style:italic>local</span> </code></pre></div><h3 id=service-setup>service-setup</h3><p>Setup a new local git repository and scaffolds the project.
Remote Git repository and CI pipeline will be created and configured based on the <code>.buildtools.yaml</code> settings.</p><p>Basic usage <code>service-setup &lt;name&gt;</code>, it&rsquo;s also possible to scaffold for a certain stack. Supported stacks:</p><ul><li><a href=https://golangci.com/>go</a></li><li><a href=https://www.scala-lang.org/>scala</a></li></ul><p>This will generate some basic project files for the different stacks, example</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ service-setup -s go <span style=color:#8be9fd;font-style:italic>test</span>
$ tree <span style=color:#8be9fd;font-style:italic>test</span>
    *TODO*</code></pre></div><h3 id=kubecmd>kubecmd</h3><p>TODO</p></div><div class=Page id="Continuous Integration"><h1><a href=https://buildtool.github.io/ci/>Continuous Integration</a></h1><p>Command recognize which CI/CD environment they are executed in based on which environment variables are present.</p><table><thead><tr><th align=left>Environment variable</th><th align=left>CI/CD</th><th align=left>Scaffolding</th></tr></thead><tbody><tr><td align=left><code>BUILDKITE_PIPELINE_SLUG</code></td><td align=left><a href=https://buildkite.com>buildkite</a></td><td align=left>✅</td></tr><tr><td align=left><code>CI_PROJECT_NAME</code></td><td align=left><a href=https://docs.gitlab.com/ee/ci>gitlab ci</a></td><td align=left>✅</td></tr><tr><td align=left><code>RUNNER_WORKSPACE</code></td><td align=left><a href=https://github.com/features/actions>github actions</a></td><td align=left></td></tr><tr><td align=left><code>TEAMCITY_PROJECT_NAME</code></td><td align=left><a href=https://www.jetbrains.com/teamcity>teamcity</a></td><td align=left></td></tr><tr><td align=left><code>BUILD_REPOSITORY_NAME</code></td><td align=left><a href=https://azure.microsoft.com/en-us/services/devops/pipelines/>azure devops</a></td><td align=left></td></tr></tbody></table></div><div class=Page id="Configuration files"><h1><a href=https://buildtool.github.io/config/>Configuration files</a></h1><p>Configuration and setup is done in <code>.buildtools.yaml</code> files.
Those files must be present in the project folder or upwards in the directory structure.
This lets you create a common <code>.buildtools.yaml</code> file to be used for a set of projects.
The <code>.buildtools.yaml</code> files will be merged together, and settings from file closest to the project being used first.</p><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ <span style=color:#8be9fd;font-style:italic>pwd</span>
~/source/
$ tree
.
├── customer1
│   ├── project1
│   └── project2
└── customer2
    └── project1</code></pre></div><p>Here we can choose to put a <code>.buildtools.yaml</code> file in the different <code>customer</code> directories since they (most likely) have different deployment configuration.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ <span style=color:#8be9fd;font-style:italic>pwd</span>
~/source/
$ cat .buildtools.yaml
registry:
  dockerhub:
    repository: buildtool
environments:
  - name: <span style=color:#8be9fd;font-style:italic>local</span>
    context: docker-desktop
    namespace: default

$ <span style=color:#8be9fd;font-style:italic>cd</span> customer1
$ cat .buildtools.yaml
environments:
  - name: prod
    context: production
    namespace: default
    kubeconfig: ~/.kube/config.d/production.yaml

$ <span style=color:#8be9fd;font-style:italic>cd</span> project2
$ cat .buildtools.yaml
environments:
  - name: staging
    context: staging
    namespace: project2

$ build -printconfig

$ <span style=color:#8be9fd;font-style:italic>cd</span> ..

$ build -printconfig</code></pre></div><h3 id=buildtools-yaml>.buildtools.yaml</h3><p>A typical configuration file consists of a <code>registry</code> config and a list of <code>environments</code> to use.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>registry:
  dockerhub:
    repository: buildtool
environments:
  local-test:
    context: docker-desktop
  staging:
    context: staging-aws-eu-west<span style=color:#bd93f9>-1</span>
    namespace: my-test </code></pre></div><p>See the following sections for information on how to configure the different parts of the configuration files.</p></div><div class=Page id=Registry><h1><a href=https://buildtool.github.io/registry/>Registry</a></h1><p>The <code>registry</code> key in <code>.buildtools.yaml</code> defines the docker registry used for the project. This will primarily be used for CI pipelines to push built docker images.
Locally it can be used to build images with correct tags, making it possible to deploy locally built images.</p><p>The following registries are supported:</p><table><thead><tr><th align=left>Config key</th><th align=left>Container registry</th></tr></thead><tbody><tr><td align=left><a href=#dockerhub><code>dockerhub</code></a></td><td align=left><a href=https://hub.docker.com/>Docker hub</a></td></tr><tr><td align=left><a href=#ecr><code>ecr</code></a></td><td align=left><a href=https://docs.aws.amazon.com/ecr/index.html>AWS Elastic Container Registry</a></td></tr><tr><td align=left><a href=#github><code>github</code></a></td><td align=left><a href=https://help.github.com/en/github/managing-packages-with-github-package-registry/about-github-package-registry>Github package registry</a></td></tr><tr><td align=left><a href=#gitlab><code>gitlab</code></a></td><td align=left><a href=https://docs.gitlab.com/ee/user/packages/container_registry/>Gitlab container registry</a></td></tr><tr><td align=left><a href=#quay><code>quay</code></a></td><td align=left><a href=https://docs.quay.io/>Quay docker registry</a></td></tr></tbody></table><h3 id=dockerhub>dockerhub</h3><table><thead><tr><th align=left>Parameter</th><th align=left>Description</th><th align=left>Env variable</th></tr></thead><tbody><tr><td align=left><code>namespace</code></td><td align=left>The namespace to publish to</td><td align=left><code>DOCKERHUB_NAMESPACE</code></td></tr><tr><td align=left><code>username</code></td><td align=left>User to authenticate</td><td align=left><code>DOCKERHUB_USERNAME</code></td></tr><tr><td align=left><code>password</code></td><td align=left>Password for <code>user</code> authentication</td><td align=left><code>DOCKERHUB_PASSWORD</code></td></tr></tbody></table><h3 id=ecr>ecr</h3><p>AWS Credentials must be supplied as <code>ENV</code> variables, read more <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html>here</a>.</p><table><thead><tr><th align=left>Parameter</th><th align=left>Description</th><th align=left>Env variable</th></tr></thead><tbody><tr><td align=left><code>url</code></td><td align=left>The ECR registry URL</td><td align=left><code>ECR_URL</code></td></tr><tr><td align=left><code>region</code></td><td align=left>Specify a region (if it&rsquo;s possible to derive from the <code>url</code> parameter it can be omitted)</td><td align=left><code>ECR_REGION</code></td></tr></tbody></table><h3 id=github>github</h3><p>To authenticate <code>token</code> or a combination of <code>username</code> and <code>password</code> must be provided.</p><table><thead><tr><th align=left>Parameter</th><th align=left>Description</th><th align=left>Env variable</th></tr></thead><tbody><tr><td align=left><code>repository</code></td><td align=left>The repository part of the docker image name</td><td align=left><code>GITHUB_REPOSITORY</code></td></tr><tr><td align=left><code>username</code></td><td align=left>User to authenticate</td><td align=left><code>GITHUB_USERNAME</code></td></tr><tr><td align=left><code>password</code></td><td align=left>Password for <code>user</code> authentication</td><td align=left><code>GITHUB_PASSWORD</code></td></tr><tr><td align=left><code>token</code></td><td align=left>A personal access token to use for authentication</td><td align=left><code>GITHUB_TOKEN</code></td></tr></tbody></table><h3 id=gitlab>gitlab</h3><table><thead><tr><th align=left>Parameter</th><th align=left>Description</th><th align=left>Env variable</th></tr></thead><tbody><tr><td align=left><code>registry</code></td><td align=left>The repository part of the docker image name</td><td align=left><code>CI_REGISTRY</code></td></tr><tr><td align=left><code>repository</code></td><td align=left>The repository part of the docker image name</td><td align=left><code>CI_REGISTRY_IMAGE</code></td></tr><tr><td align=left><code>token</code></td><td align=left>A personal access token to use for authentication</td><td align=left><code>CI_TOKEN</code></td></tr></tbody></table><h3 id=quay>quay</h3><table><thead><tr><th align=left>Parameter</th><th align=left>Description</th><th align=left>Env variable</th></tr></thead><tbody><tr><td align=left><code>repository</code></td><td align=left>The repository part of the docker image name</td><td align=left><code>QUAY_REPOSITORY</code></td></tr><tr><td align=left><code>username</code></td><td align=left>User to authenticate</td><td align=left><code>QUAY_USERNAME</code></td></tr><tr><td align=left><code>password</code></td><td align=left>Password for <code>user</code> authentication</td><td align=left><code>QUAY_PASSWORD</code></td></tr></tbody></table></div><div class=Page id=Environments><h1><a href=https://buildtool.github.io/environments/>Environments</a></h1><p><code>environments</code> specifies the different deployment &lsquo;targets&rsquo; to use for the project.
The environments matches Kubernetes cluster <a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#define-clusters-users-and-contexts>configurations</a> to deploy projects.
Setting up Kubernetes contexts and namespaces is not handled by these tools.</p><p>The only required configuration is <code>context</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>environments:
  &lt;name&gt;:
    context:
    namespace:
    kubeconfig:</code></pre></div><table><thead><tr><th align=left>Parameter</th><th align=left>Default</th><th align=left>Description</th></tr></thead><tbody><tr><td align=left><code>context</code></td><td align=left></td><td align=left>Which context in the Kubernetes configuration to use</td></tr><tr><td align=left><code>namespace</code></td><td align=left><code>default</code></td><td align=left>Specific namespace to deploy to</td></tr><tr><td align=left><code>kubeconfig</code></td><td align=left>value of <code>KUBECONFIG</code> <code>ENV</code> variable</td><td align=left>Full path to a specific kubeconfig file to use</td></tr></tbody></table></div><div class=Page id=Contributing><h1><a href=https://buildtool.github.io/contributing/>Contributing</a></h1><p>Work in progress&hellip;
Check the <a href=https://github.com/buildtool/build-tools/blob/master/CONTRIBUTING.md>CONTRIBUTING.md</a></p></div><div class=Footer><p>© 2019 buildtool</p></div><script src=https://buildtool.github.io/js/index.js></script></div></div></div></body></html>